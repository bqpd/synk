<html>
<meta http-equiv="Content-Type" content="text/html; Charset=UTF-8"  />
<link href='https://fonts.googleapis.com/css?family=Dosis:400,600' rel='stylesheet' type='text/css'>
<head>
    <title> synk </title>
    <style>
.button {
    cursor: pointer;
}

body {
    width: 250px;
    margin: 0 auto;
    font-size: 3em;
    font-weight: 400;
    line-height: 2;
    background: black;
    color: white;
    font-family: "Dosis";
    text-align: right;
}

h1 {
    font-size: 2em;
    font-weight: 600;
    text-align: left;
}
    </style>
</head>

<body>
    <h1>
        SCORE <span id="score"></span>
    </h1>

    <div id="one" onclick="conn.send('1');" class="button"> 1 </div>
    <div id="two" onclick="conn.send('2');" class="button"> 2 </div>
    <div id="three" onclick="conn.send('3');" class="button"> 3 </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>
    <script src="https://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha3.js"></script>
    <script>

/*
* Websocket interfacing *
*/
var subd = 'default'

var last_connection_time = 0,
    connecting = false,
    host = "ws://synk.herokuapp.com",
    conn,
    score = 0,
    client_id = Math.random().toString(36).slice(2).substring(0,13),

    connectWS = function() {
        if (window["WebSocket"]) {
            conn = new WebSocket(host+"/socket/"+subd)
            conn.onopen = function() {
                conn.send(client_id)
            }
            conn.onclose = function (evt) {
                console.log("The connection has closed.")
                delayedConnect() }
                conn.onmessage = function (evt) {
                    if (evt.data !== ">heartbeat<") {
                        console.log(evt.data);
                        code = evt.data.substr(0,4);
                        if (code === "FAIL") {
                            $("body").css("background", "#a13")
                        } else if (code === "GOOD"){
                            $("body").css("background", "#5a5")
                            score++;
                        } else if (code === "INIT") {
                            data = evt.data.substr(5).split(" ");
                            $("#one").html(data[0]);
                            $("#two").html(data[1]);
                            $("#three").html(data[2]);
                        }
                        $("#score").html(score);
                    }
                }
            } else {
                console.log("Sadly, your browser does not support WebSockets.")
            }
            connecting = false
        },

    delayedConnect = function() {
        if ( !connecting ) {
            var time = new Date().getTime()
            if ( time > last_connection_time ) {
                var delay = Math.max(last_connection_time+5000, time) - time
                last_connection_time = time + delay
                connecting = true
                setTimeout( connectWS, delay )
            }
        }
    }

    /*
    * Message parsing and display *
    */


    $(document).ready(connectWS)

    var beat = true,
    heartbeat = function() {
        if (beat && conn.readyState === 1) {
            conn.send(">heartbeat<")
        }
        setTimeout("heartbeat()", 30000)
    }

    setTimeout("heartbeat()", 60000)
</script>
</body>


</html>
